@{
    ViewData["Title"] = "Calendar";
}

<h2>@ViewData["Title"]</h2>

<div id="calendar"></div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            eventSources: [
                {
                    url: '/Calendar/GetBookings', // Første datakilde
                    method: 'GET',
                    failure: function() {
                        console.error('Failed to fetch bookings');
                    }
                },
                {
                    url: '/Calendar/GetEvents', // Anden datakilde
                    method: 'GET',
                    failure: function() {
                        console.error('Failed to fetch events');
                    }
                },
                {
                    url: '/Calendar/GetRooms', // Tredje datakilde
                    method: 'GET',
                    failure: function() {
                    console.error('Failed to fetch rooms');
                    }
                }
            ],

            dateClick: function(info) {
                //Set the selected date in the hidden input
                document.getElementById('selectedDate').value = info.dateStr;

                //Open the modal
                $('#bookingModal').modal('show');
            },
            eventClick: function(info) {
                // Prevent default behavior (e.g., navigating to a URL)
                info.jsEvent.preventDefault();

                // Log event details for debugging
                console.log('Event clicked:', info.event);

                // Populate modal with event details
                document.getElementById('bookingModalLabel').innerText = 'Booking Details';
                document.getElementById('startTime').value = info.event.start.toISOString().slice(0, 16); // Format datetime
                document.getElementById('endTime').value = info.event.end ? info.event.end.toISOString().slice(0, 16) : '';
                document.getElementById('room').value = info.event.extendedProps.roomName || '';
                document.getElementById('residency').value = info.event.extendedProps.residency || '';

                // Disable form inputs to make it read-only
                document.getElementById('startTime').disabled = true;
                document.getElementById('endTime').disabled = true;
                document.getElementById('room').disabled = true;
                document.getElementById('residency').disabled = true;

                // Show the modal
                $('#bookingModal').modal('show');
                
            }


        });

        calendar.render();
    });
    </script>

    <div class="modal fade" id="bookingModal" tabindex="-1" role="dialog" aria-labelledby="bookingModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bookingModalLabel">Create Booking</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="bookingForm">
                        <div class="form-group">
                            <!-- skal være kun tidspunkt, da man jo klikker på datoen-->
                            <label for="startTime">Start Time</label>
                            <input type="datetime-local" class="form-control" id="startTime" required>
                        </div>
                        <div class="form-group">
                            <label for="endTime">End Time</label>
                            <input type="datetime-local" class="form-control" id="endTime" required>
                        </div>
                        <div class="form-group">
                            <label for="room">Room</label>
                            <select class="form-control" id="room" required>
                            </select>
                        </div>
                        <!-- skal auto hentes fra sin session/identity? -->
                        <div class="form-group">
                            <label for="residency">Residency</label>
                            <select class="form-control" id="residency" required>
                            </select>
                        </div>
                        <input type="hidden" id="selectedDate">
                        <button type="submit" class="btn btn-primary">Save Booking</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

}
